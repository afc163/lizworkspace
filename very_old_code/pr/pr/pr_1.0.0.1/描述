23:09 蔡俊杰gtalk: 在么？
23:10 我: 在了
 蔡俊杰gtalk: 现在有空么？
 我: you
  当然有，你是不是刚回？
 蔡俊杰gtalk: 恩
23:11 那我可以说说我下午和你提到的事情么？
 我: 可以啊
23:12 你尽管说～
23:13 蔡俊杰gtalk: 恩，是这样的一个想法，对程序和脚本、配置文件的内在关系进行一个自动化描述，原因是，一个应用系统很复杂，涉及到很多的shell脚本，perl脚本、c程序，一个人要全盘掌握不是太容易，所以我想能有个工具自动产生里面的关系
23:14 主要涉及技术点，python用于数据文件解析，前段用django
23:16 这个你感兴趣么？如果不感兴趣可以换一个 ：）
 我: 等等，我仔细看看
23:17 内在关系是指什么，能举个例子吗
 蔡俊杰gtalk: 你现在写一个工具有几个文件？
23:18 我: 至多就两三个文件，你说的是相互之间调用关系？
 蔡俊杰gtalk: 可以这么说，实际中一个项目有好多的开发人员写，mp3服务有6个人写。所以大概几百个文件是很正常的
23:21 我: 是不是对数据文件提取些关键字然后其他文件匹配这些，看是否有这些关键字，是的话就认为文件之间有联系，具体的联系也要保存的吧
 蔡俊杰gtalk: 对
  原理是这样
23:23 基本上程序运行格式是
pr.py /home/mp3/mp3db

运行完毕后，就会产生一个文件，这个文件中记录了脚本调用了哪些程序，程序使用了哪些配置文件，脚本调用了哪些脚本，这种逻辑关系
 我: 好啊，就做这个
  mp3db是什么
23:24 蔡俊杰gtalk: 然后这种逻辑关系就可以在前台通过html方式显示出来
  呵呵，商业机密
 我: 估计是数据库，里面就是有好多歌曲吧～～
 蔡俊杰gtalk: 错拉
  mp3db不是数据库
23:25 百度的很多服务只用文本数据库来存放
  而mp3db不是数据库，里面放了一些程序和脚本，用来处理一些事情
23:26 我: 哦
  这名字取得不好，呵呵
 蔡俊杰gtalk: ok，还有什么问的么？
  呵呵，不是我取的
  历史问题了
23:28 如果你确定错的话，那我们一起定个计划，这里面我也会进行相关的开发。我们需要分工下，因为可能会有点复杂
 我: 恩，我确定
23:29 做
 蔡俊杰gtalk: 我先问下，你近来的计划安排，有没有原先需要做的事情，你先说，我把pr1.0.0发给你
23:30 我: 因为有些小试还要考，不过没什么关系，不多都是开卷，呵呵
 蔡俊杰gtalk: 哦
23:31 我: 说错了，很多都是开卷，不是不多
23:32 问下，准备打算花多久完成
 蔡俊杰gtalk: 我已经发给你了
  过年前可以么？
 我: 恩～
  可以，absoultly ok
23:34 蔡俊杰gtalk: 这样的，我当然希望越快越好，但是涉及到你我的时间问题，所以我先定在过年前，1月底，如果我们提前完成，算是一个成功合作，许个愿望，也许我能满足你 ：）
23:35 我: 嗯嗯
  那祝我们第一次真正的合作成功～
  你说许个愿望？what？
23:37 蔡俊杰gtalk: 呵呵，算是奖励拉
  这样，你下载到了么？
 我: 恩，刚刚收到
23:38 蔡俊杰gtalk: 这个程序大概是我9月份的一个初稿，当时大概设计了下。我现在拿出来我们重新晚上下
  完善下
23:40 我: 有点乱码，不过我是在windows下，明天去实验室看看
 蔡俊杰gtalk: 我先跟你讲一个情况，pr程序的运行原理是扫描目录下面的shell文件，然后读取改文件，提取出程序和配置文件名
  恩
 我: 你继续讲～
 蔡俊杰gtalk: 今天我大概说下，你明天可以搭个环境试运行下，不懂在问我
23:42 提取出的程序和配置文件的相关信息需要完整记录下来，记录到数据库里面
  然后，前台程序会读数据库，并从数据库取出相关内容进行图形化显示
23:43 我初步分了下，数据库的操作，我来实现，前端设计由你来实现（你的设计很不错呢），前端的功能我们共同实现，数据的分析，我们共同实现
23:44 如果有什么变动，到时候具体再定
 我: 恩，可以
23:45 蔡俊杰gtalk: 这个项目，大概能锻炼一下你的数据库操作，在django中也需要用到，使用mysql数据库
 我: 恩，好～
23:46 蔡俊杰gtalk: ok，pr程序里面采用递归形式来分析shell文件
23:47 你明天可以先看看，怎么个逻辑结构，然后我们再讨论
  好了，有什么问题么？
 我: 恩，我先看看你传过来的
 蔡俊杰gtalk: 恩，好的
23:48 我: 现在没什么问题
23:49 你还有什么要说的吗
23:50 蔡俊杰gtalk: 没什么了，等你看了，我们再交流
 我: 恩，好的




项目名称：pr-1.0.0.0
撰写人：蔡俊杰
文档版本：1.0.0

需求背景：
	在一个大型项目中，涉及的程序文件数量庞大，为了呈现整个架构的调用关系，以往都是由实习生一个模块一个模块来学习，耗时几个月才能初步理解一个服务的架构，但依然存在盲点，以致在维护管理服务时候出现空白区，功能扩展出现问题等等。
	针对上述问题，在分析了百度的服务特点后，即用脚本粘合程序。能设计一个自动化工具，来帮助呈现整个服务架构的调用关系，这样将极大提高程序开发人员对整个服务架构的全局把握。

服务文件类型：
（1）c程序（不含扩展名）
（2）shell程序（.sh）
（3）perl程序（.pl）
（4）python程序（.py）
（5）配置文件（.conf）
（6）普通文件（.txt）
（7）其它文件，比如字典文件（.dict），改类型文件扩展名可变

服务特点基本介绍：
	
	脚本调用程序的特点，程序和程序之间以数据目录为衔接，即一个程序的输出数据即为下一个程序的输入数据。

pr自动化工具的最终使用方式：
	
	命令行带参数解析模式。整个服务的关联关系将录入mysql数据库，前端配合web显示。

	比如，
	查看mp3db目录下所有程序的依赖关系：  ./pr.py -d /home/mp3/mp3db
	查看某一个mp3refresh.sh脚本的依赖关系：./py.pr -f /home/mp3/mp3db/mp3refresh.sh


pr自动化工具的功能需求说明（待补充）
（1）支持命令行参数解析，即 -d -f -c -y 等等。
（2）支持对shell脚本的解析，提取其调用的脚本（以下脚本包括shell脚本、perl脚本、python脚本）、程序（以下程序都指c程序）、配置文件（以下配置文件仅指.conf）。提取的信息包含：
	（a）绝对路径。如果当前脚本不含绝对路径，那么以当前目录做为路径。
	比如 ../pr.py -f mp3refresh.sh ，那么这个mp3refresh脚本的绝对路径信息就是./当前目录。
	（b）程序和脚本的md5值，可以使用命令md5sum mp3refresh.sh来获取。
	（c）预留功能，有可能收收集更多信息，这些信息只指文件信息，比如这个文件的大小等。
（3）最后解析的关联关系结构需要完全保存。建议初步使用字典来保存，关键字是shell脚本名，值为调用的程序，脚本和配置文件。

./a -i input -o output

2008-01-09 补充
（4）脚本中如果有wget命令，那么记录当前wget的机器名（即ftp主机名）和wget的远程文件名（加路径），无需其它信息。（目前的ftp解析路径有问题）
比如：wget -O ${_DX_DATAPATH}/script_extract.txt.05 ftp://tc-dx05.tc.baidu.com//home/mp3/history/script_extract.txt
那么，提取信息tc.dx05.tc.baidu.com ，下载的路径/home/mp3/history/script_extract.txt

（5）如果当前脚本中被调用的脚本、程序、配置文件无法找到，则需要标示出。
（6）路径中带有变量的解析异常情况的处理：比如：
cc=”a”   cd /home/mp3/mp3db/${cc}  目前脚本这是正确的。但
c=”a”   cd  /home/mp3/mp3db/${cc}  无法解析的情况下，那么这个路径下的脚本、程序、配置文件都会无法找到，标记出（5）的同时，还要标记出这个路径错误。

（7）c程序的,一般脚本中调用c程序的习惯是   ./a [参数]  [文件名]  [参数]
比如  a） ./mp3stat     不带任何参数的调用
	b） ./mp3stat  1 2 3    带参数的调用
	c） ./mp3stat  -o  output    带输出文件的调用
	d） ./mp3stat -i ../conf/a.conf  -o ../data/  带路径的调用
目前就包含这四种情况，这4种情况的共同点是，都以./mp3stat开头，所以pr中主要出现。/×××  那么就可以认为是程序，同时程序需要记录的信息是，这个程序如果带-i和-o，那么把后面的东西记录下来。   ???????????????????/ 




(17时34分18秒) 蔡俊杰gtalk: 你是在变量有./的情况下没有处理
(17时34分22秒) 蔡俊杰gtalk: HOMEPATH="./"
DESPATH="./static"
17时37分37秒) 蔡俊杰gtalk: //或者/./都只要变成/即可

第二  c程序提取你可以   ./a 来判断   或者   a （主要这种情况下 which a 一下，以便确定其存在）
依然从get_new_data.sh中反应的情况，需要对wget中提取的信息增加一个File Tye为 ftp 标记
变成 File Type：ftp=>.txt会更易读
(17时39分13秒) 蔡俊杰gtalk: 没有这个必要嘛，因为，第一，配置文件一般都是变成 File Type：ftp=>.txt会更易读加在变量中 即a="b.conf" 你才需要企图
